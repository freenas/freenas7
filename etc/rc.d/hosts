#!/bin/sh
# Copyright Â© 2007 Volker Theile (votdev@gmx.de)
# All rights reserved.

# PROVIDE: hosts
# BEFORE: NETWORKING

. /etc/util.subr
. /etc/configxml.subr

echo "Updating hosts."

# Get interface address.
_if=`/usr/local/bin/xml sel -t -v "//interfaces/lan/if" ${configxml_file}`
_ipaddr=`get_ipaddr inet ${_if}`

# Generate /etc/hosts file.
/usr/local/bin/xml sel -t -m "//system" -o "::1 localhost localhost." -v domain -n \
	-o "127.0.0.1 localhost localhost." -v domain -n \
	-o "${_ipaddr} " -v hostname -o "." -v domain -o " " -v hostname -n \
	-t -m "//system/hosts" -i "string-length(name) > 0" -v address -o " " -v name -n \
	${configxml_file} > /etc/hosts
